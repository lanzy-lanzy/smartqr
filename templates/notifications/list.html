{% extends 'base.html' %}

{% block title %}Notifications - Smart Supply{% endblock %}
{% block page_title %}Notifications{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 py-8" x-data="{ currentFilter: '{{ current_filter }}' }">
    <!-- Header Section -->
    <div class="relative mb-10">
        <div class="absolute -top-10 -left-10 w-64 h-64 bg-primary-500/10 rounded-full blur-3xl -z-10 animate-pulse"></div>
        <div class="absolute -bottom-10 -right-10 w-64 h-64 bg-accent-500/10 rounded-full blur-3xl -z-10"></div>
        
        <div class="flex flex-col md:flex-row md:items-end justify-between gap-6">
            <div>
                <nav class="flex items-center gap-2 text-xs font-bold text-surface-500 uppercase tracking-widest mb-4">
                    <a href="{% url 'dashboard' %}" class="hover:text-primary-400 transition-colors">Dashboard</a>
                    <i data-lucide="chevron-right" class="w-3 h-3"></i>
                    <span class="text-surface-300">Notifications</span>
                </nav>
                <h2 class="text-4xl md:text-5xl font-black text-white tracking-tight mb-3">
                    Notifications
                </h2>
                <div class="flex items-center gap-3">
                    <div class="flex items-center gap-2 px-3 py-1 bg-white/5 backdrop-blur-md rounded-full border border-white/10">
                        <span class="relative flex h-2 w-2">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-2 w-2 bg-primary-500"></span>
                        </span>
                        <span class="text-sm font-semibold text-surface-300">
                            {{ unread_count }} unread <span class="text-surface-500 font-medium">/ {{ total_count }} total</span>
                        </span>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center gap-3">
                {% if unread_count > 0 %}
                <form method="POST" action="{% url 'notification_mark_all_read' %}" class="inline" up-submit up-target="main">
                    {% csrf_token %}
                    <button type="submit" class="group relative flex items-center gap-2 px-5 py-2.5 bg-white/5 hover:bg-white/10 text-white rounded-xl border border-white/10 transition-all duration-300 overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-r from-primary-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        <i data-lucide="check-check" class="w-4 h-4 text-primary-400 group-hover:scale-110 transition-transform"></i>
                        <span class="text-sm font-bold">Mark all read</span>
                    </button>
                </form>
                {% endif %}
                
                {% if total_count > unread_count %}
                <form method="POST" action="{% url 'notification_delete_all_read' %}" class="inline" up-submit up-target="main">
                    {% csrf_token %}
                    <button type="submit" class="group flex items-center gap-2 px-5 py-2.5 bg-red-500/5 hover:bg-red-500/10 text-red-400 rounded-xl border border-red-500/10 transition-all duration-300">
                        <i data-lucide="trash-2" class="w-4 h-4 group-hover:rotate-12 transition-transform"></i>
                        <span class="text-sm font-bold">Delete read</span>
                    </button>
                </form>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Filter Bar -->
    <div class="flex items-center p-1.5 bg-white/5 backdrop-blur-xl rounded-2xl border border-white/10 mb-8 sticky top-20 z-20 shadow-2xl shadow-black/20">
        <a href="{% url 'notifications' %}" up-target="main"
           class="flex-1 flex items-center justify-center gap-2 py-3 px-4 rounded-xl text-sm font-bold transition-all duration-300 
           {% if current_filter == 'all' %}bg-white/10 text-white shadow-xl ring-1 ring-white/20{% else %}text-surface-400 hover:text-surface-200 hover:bg-white/5{% endif %}">
            <i data-lucide="layout-grid" class="w-4 h-4"></i>
            All
        </a>
        <a href="{% url 'notifications' %}?filter=unread" up-target="main"
           class="flex-1 flex items-center justify-center gap-2 py-3 px-4 rounded-xl text-sm font-bold transition-all duration-300
           {% if current_filter == 'unread' %}bg-primary-500 text-white shadow-lg shadow-primary-500/20{% else %}text-surface-400 hover:text-surface-200 hover:bg-white/5{% endif %}">
            <i data-lucide="bell" class="w-4 h-4"></i>
            Unread
            {% if unread_count > 0 %}
            <span class="px-2 py-0.5 bg-red-500/90 rounded-full text-[10px] font-black tracking-tighter text-white">{{ unread_count }}</span>
            {% endif %}
        </a>
        <a href="{% url 'notifications' %}?filter=read" up-target="main"
           class="flex-1 flex items-center justify-center gap-2 py-3 px-4 rounded-xl text-sm font-bold transition-all duration-300
           {% if current_filter == 'read' %}bg-white/10 text-white shadow-xl ring-1 ring-white/20{% else %}text-surface-400 hover:text-surface-200 hover:bg-white/5{% endif %}">
            <i data-lucide="eye" class="w-4 h-4"></i>
            Read
        </a>
    </div>

    <!-- Notifications Main Container -->
    {% if notifications_list %}
    <div class="grid gap-4">
        {% for notification in notifications_list %}
        <div class="group relative" id="notification-{{ notification.id }}">
            <div class="glass-panel overflow-hidden rounded-2xl border border-white/5 transition-all duration-500 hover:border-white/20 hover:shadow-2xl hover:shadow-primary-500/5 
                {% if not notification.is_read %}bg-gradient-to-r from-primary-500/10 via-white/[0.02] to-transparent border-primary-500/20{% endif %}">
                
                <div class="p-5 md:p-6 flex gap-5">
                    <!-- Icon Container -->
                    <div class="relative flex-shrink-0">
                        <div class="w-16 h-16 rounded-2xl flex items-center justify-center text-2xl shadow-inner
                            {% if notification.notification_type == 'request_approved' %}bg-green-500/20 text-green-400
                            {% elif notification.notification_type == 'request_rejected' %}bg-red-500/20 text-red-400
                            {% elif notification.notification_type == 'item_issued' %}bg-blue-500/20 text-blue-400
                            {% elif notification.notification_type == 'item_due_soon' %}bg-amber-500/20 text-amber-400
                            {% elif notification.notification_type == 'item_overdue' %}bg-orange-500/20 text-orange-400
                            {% elif notification.notification_type == 'new_request' %}bg-accent-500/20 text-accent-400
                            {% else %}bg-surface-600/20 text-surface-400{% endif %}">
                            
                            {% if notification.notification_type == 'request_approved' %}
                            <i data-lucide="check-circle-2" class="w-8 h-8"></i>
                            {% elif notification.notification_type == 'request_rejected' %}
                            <i data-lucide="x-circle" class="w-8 h-8"></i>
                            {% elif notification.notification_type == 'item_issued' %}
                            <i data-lucide="package-check" class="w-8 h-8"></i>
                            {% elif notification.notification_type == 'item_due_soon' %}
                            <i data-lucide="clock-4" class="w-8 h-8"></i>
                            {% elif notification.notification_type == 'item_overdue' %}
                            <i data-lucide="alert-triangle" class="w-8 h-8"></i>
                            {% elif notification.notification_type == 'new_request' %}
                            <i data-lucide="inbox" class="w-8 h-8"></i>
                            {% else %}
                            <i data-lucide="bell" class="w-8 h-8"></i>
                            {% endif %}
                        </div>
                        {% if not notification.is_read %}
                        <div class="absolute -top-1 -right-1 w-4 h-4 rounded-full bg-primary-500 border-2 border-slate-950 animate-pulse shadow-lg shadow-primary-500/50"></div>
                        {% endif %}
                    </div>
                    
                    <!-- Content -->
                    <div class="flex-1 min-w-0">
                        <div class="flex flex-col md:flex-row md:items-start justify-between gap-2 mb-2">
                            <div>
                                <h3 class="font-bold text-lg leading-tight {% if not notification.is_read %}text-white{% else %}text-surface-300{% endif %}">
                                    {{ notification.title }}
                                </h3>
                                <div class="flex items-center gap-3 mt-1.5">
                                    <span class="text-xs font-semibold text-surface-500 flex items-center gap-1.5">
                                        <i data-lucide="calendar" class="w-3 h-3"></i>
                                        {{ notification.created_at|date:"F d, Y" }}
                                    </span>
                                    <span class="text-surface-700">â€¢</span>
                                    <span class="text-xs font-semibold text-surface-500 flex items-center gap-1.5">
                                        <i data-lucide="clock" class="w-3 h-3"></i>
                                        {{ notification.created_at|timesince }} ago
                                    </span>
                                </div>
                            </div>
                            
                            {% if not notification.is_read %}
                            <span class="inline-flex px-2.5 py-1 bg-primary-500/10 text-primary-400 text-[10px] font-black uppercase tracking-tighter rounded-full border border-primary-500/20">
                                New Notification
                            </span>
                            {% endif %}
                        </div>
                        
                        <p class="text-sm md:text-base leading-relaxed text-surface-400 mb-5">
                            {{ notification.message }}
                        </p>
                        
                        <div class="flex flex-wrap items-center gap-4">
                            {% if notification.link %}
                            <a href="{{ notification.link }}" up-target="main"
                               class="inline-flex items-center gap-2 text-sm font-bold text-primary-400 hover:text-primary-300 transition-colors">
                                <i data-lucide="external-link" class="w-4 h-4"></i>
                                View Activity
                            </a>
                            {% endif %}
                            
                            {% if not notification.is_read %}
                            <form method="POST" action="{% url 'notification_mark_read' notification.id %}" up-submit up-target="main">
                                {% csrf_token %}
                                <button type="submit" class="inline-flex items-center gap-2 text-sm font-bold text-surface-300 hover:text-white transition-colors">
                                    <i data-lucide="check" class="w-4 h-4"></i>
                                    Mark as read
                                </button>
                            </form>
                            {% endif %}
                            
                            <form method="POST" action="{% url 'notification_delete' notification.id %}" up-submit up-target="main">
                                {% csrf_token %}
                                <button type="submit" class="inline-flex items-center gap-2 text-sm font-bold text-surface-500 hover:text-red-400 transition-colors">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    Delete
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Hover Glow Effect -->
            <div class="absolute inset-0 -z-10 bg-gradient-to-r from-primary-500/5 via-transparent to-accent-500/5 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity blur-xl"></div>
        </div>
        {% endfor %}
    </div>

    <!-- Modern Pagination -->
    {% if notifications_list.has_other_pages %}
    <div class="mt-12 flex items-center justify-between p-4 bg-white/5 backdrop-blur-md rounded-2xl border border-white/10">
        <p class="text-sm font-medium text-surface-400">
            Showing <span class="text-white font-bold">{{ notifications_list.start_index }}-{{ notifications_list.end_index }}</span> 
            of <span class="text-white font-bold">{{ total_count }}</span>
        </p>
        
        <div class="flex items-center gap-3">
            {% if notifications_list.has_previous %}
            <a href="?page={{ notifications_list.previous_page_number }}{% if current_filter != 'all' %}&filter={{ current_filter }}{% endif %}"
               up-target="main"
               class="p-2.5 rounded-xl bg-white/5 border border-white/10 text-surface-300 hover:bg-white/10 hover:text-white transition-all shadow-sm">
                <i data-lucide="chevron-left" class="w-5 h-5"></i>
            </a>
            {% endif %}
            
            <div class="flex items-center gap-1.5">
                <span class="px-4 py-2 bg-primary-500 text-white font-bold rounded-xl shadow-lg shadow-primary-500/20">
                    {{ notifications_list.number }}
                </span>
                <span class="text-surface-500 font-bold px-1">/</span>
                <span class="text-surface-300 font-bold px-1">{{ notifications_list.paginator.num_pages }}</span>
            </div>
            
            {% if notifications_list.has_next %}
            <a href="?page={{ notifications_list.next_page_number }}{% if current_filter != 'all' %}&filter={{ current_filter }}{% endif %}"
               up-target="main"
               class="p-2.5 rounded-xl bg-white/5 border border-white/10 text-surface-300 hover:bg-white/10 hover:text-white transition-all shadow-sm">
                <i data-lucide="chevron-right" class="w-5 h-5"></i>
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}

    {% else %}
    <!-- Stunning Empty State -->
    <div class="relative py-20 px-6 overflow-hidden glass-panel rounded-3xl border border-white/10 text-center">
        <!-- Background Decorations -->
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[500px] bg-primary-500/5 rounded-full blur-[100px] animate-pulse"></div>
        
        <div class="relative z-10">
            <div class="w-32 h-32 rounded-3xl bg-gradient-to-br from-white/5 to-white/[0.02] border border-white/10 flex items-center justify-center mx-auto mb-8 shadow-2xl relative group">
                <div class="absolute inset-0 bg-primary-500/20 rounded-3xl blur-2xl group-hover:blur-3xl transition-all"></div>
                <i data-lucide="bell-off" class="w-16 h-16 text-surface-500 relative z-10 group-hover:scale-110 transition-transform duration-500"></i>
            </div>
            
            <h3 class="text-3xl font-black text-white mb-4 tracking-tight">
                {% if current_filter == 'unread' %}
                All Caught Up!
                {% else %}
                Nothing to See Here
                {% endif %}
            </h3>
            
            <p class="text-surface-400 max-w-md mx-auto text-lg leading-relaxed mb-10">
                {% if current_filter == 'unread' %}
                You've read all your notifications. We'll alert you as soon as there's something new.
                {% else %}
                Your notification center is empty. Check back later for activity on your requests and account.
                {% endif %}
            </p>
            
            <a href="{% url 'dashboard' %}" up-target="main"
               class="inline-flex items-center gap-3 px-8 py-4 bg-primary-500 hover:bg-primary-400 text-white rounded-2xl font-bold transition-all shadow-xl shadow-primary-500/20 active:scale-95">
                <i data-lucide="arrow-left" class="w-5 h-5"></i>
                Back to Dashboard
            </a>
        </div>
    </div>
    {% endif %}
</div>

<style>
    @keyframes pulse-slow {
        0%, 100% { opacity: 0.3; transform: scale(1); }
        50% { opacity: 0.5; transform: scale(1.05); }
    }
    
    .glass-panel {
        background: rgba(15, 23, 42, 0.6);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
    }
</style>
{% endblock %}

